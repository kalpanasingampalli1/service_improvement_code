DECLARE @LAST_EOD_DT DATETIME; DECLARE @SYS_PRM INT; 

DECLARE @ALRT_CHECK INT; DECLARE @STATUS VARCHAR (20)

SET @LAST_EOD_DT= (SELECT top 1 MAX (GEN_TM) from ALRT_TRAN where 

ALRT_ID=202 GROUP BY GEN_TM order by GEN_TM desc);

SET @SYS_PRM= (SELECT VALUE FROM SYS_PRM WHERE ID=382);

IF @LAST_EOD_DT> (DATEADD (hh,-6, getdate ())) AND 

@LAST_EOD_DT<getdate () SET @ALRT_CHECK=1 ELSE SET @ALRT_CHECK=0;

IF @SYS_PRM=0 AND @ALRT_CHECK=1 

SET @STATUS='EOD COMPLETED'

ELSE IF @SYS_PRM = -1 AND @ALRT_CHECK = 0 SET @STATUS = 'EOD IN 

PROGRESS' ELSE SET @STATUS='EOD NOT STARTED';

SELECT @LAST_EOD_DT AS [EOD_COMPLETED_TIME], @STATUS AS 

[EOD_STATUS]

